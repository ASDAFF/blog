/* By Osvaldas Valutis, www.osvaldas.info. Available for use under the MIT License */
/* https://github.com/hovel/imagelightbox/tree/bd353eb */
(function(f,g,n,J){var l=function(){var a=n.body||n.documentElement,a=a.style;return""==a.WebkitTransition?"-webkit-":""==a.MozTransition?"-moz-":""==a.OTransition?"-o-":""==a.transition?"":!1},r=!1===l()?!1:!0,t=function(a,f,g){var c={},e=l();c[e+"transform"]="translateX("+f+")";c[e+"transition"]=e+"transform "+g+"s linear";a.css(c)},B="ontouchstart"in g,C=g.navigator.pointerEnabled||g.navigator.msPointerEnabled,w=function(a){if(B)return!0;if(!C||"undefined"===typeof a||"undefined"===typeof a.pointerType)return!1;
if("undefined"!==typeof a.MSPOINTER_TYPE_MOUSE){if(a.MSPOINTER_TYPE_MOUSE!=a.pointerType)return!0}else if("mouse"!=a.pointerType)return!0;return!1};f.fn.imageLightbox=function(a){a=f.extend({dynamicalTargets:!1,allowedTypes:"png|jpg|jpeg|gif",groupByClosest:!1,zoomScale:[],animationSpeed:250,preloadNext:1,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1},a);var x="",s={},c=f([]),e=f(),d=f(),m=0,k=0,p=0,q=!1,u=1,l=function(b){return"a"==
f(b).prop("tagName").toLowerCase()&&RegExp(".("+a.allowedTypes+")$","i").test(f(b).attr("href"))},D=function(b){b=f(b);return b.length&&a.groupByClosest?b.closest(a.groupByClosest).data("lightbox-group")||"default":"default"},y=function(){f(x).each(function(){if(!l(this))return!0;var b=f(this),a=D(b);s[a]=s[a]||f([]);s[a]=s[a].add(b)})},E=function(b){if(q)return!1;q=!1;a.dynamicalTargets&&y();b=f(b);c=f(s[D(b)]);if(!c.length)return console.log("no such targets"),!1;if(!1!==a.onStart)a.onStart();e=
b.length?b:c.first();z()},I=function(){for(var b=a.zoomScale.length-1;0<=b;b--)if(g.devicePixelRatio>=a.zoomScale[b])return a.zoomScale[b];return 1},F=function(a){a=a.attr("href");if(1==u)return a;var d="."+a.split(".").slice(-1)[0];return a.replace(d,"@"+u+"x"+d)},G=function(){if(!d.length)return!0;var a=0.8*f(g).width(),c=0.9*f(g).height(),h=new Image;h.src=d.attr("src");h.onload=function(){m=h.width/u;k=h.height/u;if(m>a||k>c){var e=m/k>a/c?m/a:k/c;m/=e;k/=e}d.css({width:m+"px",height:k+"px",top:(f(g).height()-
k)/2+"px",left:(f(g).width()-m)/2+"px"});d.show()}},z=function(b){if(q)return!1;var g=1,h=!1;"undefined"!=typeof b&&("left"==b?(g=-1,h=1):h=-1);var k=c.index(e);if(d.length){if(!1!==h&&(2>c.length||!0===a.quitOnEnd&&(-1===h&&0==k||1===h&&k==c.length-1)))return v(),!1;b={opacity:0};r?t(d,100*h-p+"px",a.animationSpeed/1E3):b.left=parseInt(d.css("left"))+100*h+"px";d.animate(b,a.animationSpeed,function(){H()});p=0}q=!0;if(!1!==a.onLoadStart)a.onLoadStart();setTimeout(function(){u=I();d=f('<img id="imagelightbox" />').attr("src",
F(e)).load(function(){d.hide().appendTo("body");G();var b={opacity:1};d.css("opacity",0);if(r)t(d,-100*h+"px",0),setTimeout(function(){t(d,"0px",a.animationSpeed/1E3)},50);else{var e=parseInt(d.css("left"));b.left=e+"px";d.css("left",e-100*h+"px")}d.animate(b,a.animationSpeed,function(){q=!1;if(!1!==a.onLoadEnd)a.onLoadEnd()});if(0<a.preloadNext)for(b=1;b<=a.preloadNext;b++)e=k+b*g,e>c.length-1?e-=c.length:0>e&&(e+=c.length),e=c.eq(e),f("<img />").attr("src",F(e)).load()}).error(function(){if(!1!==
a.onLoadEnd)a.onLoadEnd()});var b=0,n=0,l=0;d.on(C?"pointerup MSPointerUp":"click",function(b){b.preventDefault();if(a.quitOnImgClick)return v(),!1;if(w(b.originalEvent))return!0;A(m/2>(b.pageX||b.originalEvent.pageX)-b.target.offsetLeft?"left":"right")}).on("touchstart pointerdown MSPointerDown",function(c){if(!w(c.originalEvent)||a.quitOnImgClick)return!0;r&&(l=parseInt(d.css("left")));b=c.originalEvent.pageX||c.originalEvent.touches[0].pageX}).on("touchmove pointermove MSPointerMove",function(c){if(!w(c.originalEvent)||
a.quitOnImgClick)return!0;c.preventDefault();n=c.originalEvent.pageX||c.originalEvent.touches[0].pageX;p=b-n;r?t(d,-p+"px",0):d.css("left",l-p+"px")}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(b){if(!w(b.originalEvent)||a.quitOnImgClick)return!0;50<Math.abs(p)?A(0<p?"right":"left"):r?t(d,"0px",a.animationSpeed/1E3):d.animate({left:l+"px"},a.animationSpeed/2)})},a.animationSpeed+100)},A=function(a){if(q)return!1;if(-1>a||a>c.length)return console.log("index is out of range"),
!1;var d=a,f=c.index(e);"left"==a?d=f-1:"right"==a&&(d=f+1);e=-1==d?c.eq(c.length-1):d==c.length?c.eq(0):c.eq(d);z(d<f?"left":"right")},H=function(){if(!d.length)return!1;d.remove();d=f()},v=function(){if(!d.length)return!1;d.animate({opacity:0},a.animationSpeed,function(){H();q=!1;if(!1!==a.onEnd)a.onEnd()})};f(g).on("resize",G);if(a.quitOnDocClick)f(n).on(B?"touchend":"click",function(a){d.length&&!f(a.target).is(d)&&v()});if(a.enableKeyboard)f(n).on("keyup",function(a){if(!d.length)return!0;a.preventDefault();
27==a.keyCode&&v();if(37==a.keyCode||39==a.keyCode)e=c.eq(c.index(e)-(37==a.keyCode?1:-1)),e.length||(e=c.eq(37==a.keyCode?c.length:0)),z(37==a.keyCode?"left":"right")});x=this.selector;f(n).on("click",x,function(a){if(!l(this))return!0;a.preventDefault();E(this)});y();this.start=E;this.collectTargets=y;this.switchImageLightbox=A;this.getTarget=function(){return e};this.targetIsSingle=function(){return 2>c.length};this.targetIsFirst=function(){return a.quitOnEnd&&0==c.index(e)};this.targetIsLast=
function(){return a.quitOnEnd&&c.index(e)==c.length-1};this.quitImageLightbox=function(){v();return this};return this}})(jQuery,window,document);
